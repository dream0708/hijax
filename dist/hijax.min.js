!function(e,t){"function"==typeof define&&define.amd?define("hijacker",[],t):"object"==typeof exports?module.exports=t():e.Hijacker=t()}(this,function(){function e(e,t,o,n){if(n=n||{},!e||!t||!o||"object"!=typeof o)throw"Missing or invalid Hijacker proxy initialization options";this.name=e,this.condition="function"==typeof t?t:function(e){return t===e},this.callbacks={beforeSend:[],receive:[],load:[],complete:[]};var r={text:String,html:function(e){return e},xml:function(e){return e},json:JSON.parse},i=(this.dataParsers=r,n.dataParsers);if(i)for(var s in i)i.hasOwnProperty(s)&&(this.dataParsers[s]=i[s]);for(var a in o)o.hasOwnProperty(a)&&this.callbacks[a].push(o[a]);return this}function t(e){var t={},o={text:"responseText",json:"responseJSON",xml:"responseXML"};for(var n in o)e.hasOwnProperty(o[n])&&(t[n]=e[o[n]]);return t}var o={UNSENT:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4};return e.prototype.getResponseHeader=function(e,t){var n,r,i=/^(.*?):[ \t]*([^\r\n]*)$/gm;if([o.HEADERS_RECEIVED,o.LOADING,o.DONE].indexOf(e.readyState)>-1){if(r=e.getAllResponseHeaders(),!this.responseHeaders)for(this.responseHeaders={};n=i.exec(r);)this.responseHeaders[n[1].toLowerCase()]=n[2];n=this.responseHeaders[t.toLowerCase()]}return null===n?null:n},e.prototype.getResponseHeaderType=function(e){var t=this.getResponseHeader(e,"Content-Type"),o={html:/html/,json:/json/,script:/(?:java|ecma)script/};for(var n in o)if(o[n]&&o[n].test(t))return n;return"text"},e.prototype.parseResponse=function(e){var o=this.dataParsers,n=this.getResponseHeaderType(e),r=t(e);return r[n]?r[n]:o[n]?o[n](e.response||e.responseText):e.responseText},e.prototype.fireEvent=function(e,t){var o=this.callbacks[e];if(this.condition(t.url))for(var n=0;n<o.length;n++)"complete"===e||"load"===e?o[n].call(this,this.parseResponse(t),t):o[n].call(this,t)},e.prototype.addListener=function(e,t){this.callbacks[e].push(t)},e}),function(e,t){"function"==typeof define&&define.amd?define("hijax",["hijacker"],t):"object"==typeof exports?module.exports=t(require("hijacker")):e.hijax=t(e.Hijacker)}(this,function(e){function t(e,t,o){var n=function(){var n;if("function"!=typeof e)throw e+" is not a function, and cannot be proxied!";return"function"==typeof t&&t.apply(this,arguments),n=e.apply(this,arguments),"function"==typeof o&&o.apply(this,arguments),n};return n}function o(){this.proxies={},this.active=0}if(window.hijax)return window.hijax;var n,r={UNSENT:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4};return o.prototype.getXHRMethod=function(e){return window.XMLHttpRequest.prototype[e]},o.prototype.setXHRMethod=function(e,t){window.XMLHttpRequest.prototype[e]=t},o.prototype.proxyXhrMethod=function(e,o,n){var r=t(this.getXHRMethod(e),o,n);this.setXHRMethod(e,r)},o.prototype.createProxy=function(t,o,n){var r=new e(t,o,n);return this.proxies[t]=r,r},o.prototype.set=function(e,t,o){return this.createProxy(e,t,o)},o.prototype.addListener=function(e,t,o){if(!(e in this.proxies))throw e+" proxy does not exist!";this.proxies[e].addListener(t,o)},o.prototype.dispatch=function(e,t,o){var n=this.proxies;for(var r in n)n.hasOwnProperty(r)&&n[r].fireEvent(e,t);"function"==typeof o&&o()},n=window.hijax=new o,n.proxyXhrMethod("open",function(e,t){this.url=t,this.rscProxied=!1,this.onLoadProxied=!1,n.active++,n.dispatch("beforeSend",this)}),n.proxyXhrMethod("send",function(){var e=this,o=function(){n.dispatch("receive",e)},i=function(){n.dispatch("load",e)},s=function(){n.dispatch("complete",e,function(){n.active--})},a=function(){e.rscProxied&&e.onLoadProxied||("function"==typeof e.onreadystatechange&&(e._originalRSCHandler=e.onreadystatechange,e.rscProxied=!0,e.onreadystatechange=t(e.onreadystatechange,function(){e.readyState===r.DONE&&i()},function(){e.readyState===r.DONE&&s()})),"function"==typeof e.onload&&(e._originalOnLoadHandler=e.onload,e.onLoadProxied=!0,e.onload=t(e.onload,i,s)))},p=function(){e.readyState===r.HEADERS_RECEIVED?o():e.readyState===r.DONE&&(i(),s())};a(),e.rscProxied||e.onLoadProxied||e.addEventListener("readystatechange",p,!1)}),n});
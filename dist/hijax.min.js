!function(e,t){"function"==typeof define&&define.amd?define("hijacker",[],t):"object"==typeof exports?module.exports=t():e.Hijacker=t()}(this,function(){function e(e,t,n,o){if(o=o||{},!e||!t||!n||"object"!=typeof n)throw"Missing or invalid Hijacker proxy initialization options";this.name=e,this.condition="function"==typeof t?t:function(e){return t===e},this.callbacks={beforeSend:[],receive:[],complete:[]};var r={"* text":String,"text html":function(e){return e},"text json":JSON.parse},i=(this.dataParsers=r,o.dataParsers);if(i)for(var s in i)i.hasOwnProperty(s)&&(this.dataParsers[s]=i[s]);for(var a in n)n.hasOwnProperty(a)&&this.callbacks[a].push(n[a]);return this}function t(e){var t={},n={text:"responseText",json:"responseJSON"};for(var o in n)e.hasOwnProperty(n[o])&&(t[o]=e[n[o]]);return t}var n={UNSENT:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4};return e.prototype.getResponseHeader=function(e,t){var o,r,i=/^(.*?):[ \t]*([^\r\n]*)$/gm;if([n.HEADERS_RECEIVED,n.LOADING,n.DONE].indexOf(e.readyState)>-1){if(r=e.getAllResponseHeaders(),!this.responseHeaders)for(this.responseHeaders={};o=i.exec(r);)this.responseHeaders[o[1].toLowerCase()]=o[2];o=this.responseHeaders[t.toLowerCase()]}return null===o?null:o},e.prototype.detectResponseTypes=function(e){var t=[],n=this.getResponseHeader(e,"Content-Type"),o={html:/html/,json:/json/,script:/(?:java|ecma)script/};for(var r in o)if(o[r]&&o[r].test(n)){t.unshift(r);break}return t},e.prototype.parseResponse=function(e){var n,o,r=this.dataParsers,i=this.detectResponseTypes(e),s=t(e),a=i[0];if(a in s)o=a;else{for(var p in s){if(!a){o=p;break}if(r[p+" "+a])return r[p+" "+a](s[p]);n||(n=p)}o=o||n}return o?(o!==a&&a.unshift(o),s[o]):e.response},e.prototype.fireEvent=function(e,t){var n=this.callbacks[e];if(this.condition(t.url))for(var o=0;o<n.length;o++)"complete"===e?n[o].call(this,this.parseResponse(t),t):n[o].call(this,t)},e.prototype.addListener=function(e,t){this.callbacks[e].push(t)},e}),function(e,t){"function"==typeof define&&define.amd?define("hijax",["hijacker"],t):"object"==typeof exports?module.exports=t(require("hijacker")):e.hijax=t(e.Hijacker)}(this,function(e){function t(e,t,n){var o=function(){var o;if("function"!=typeof e)throw e+" is not a function, and cannot be proxied!";return"function"==typeof t&&t.apply(this,arguments),o=e.apply(this,arguments),"function"==typeof n&&n.apply(this,arguments),o};return o._original=e,o}function n(){this.proxies={},this.active=0}if(window.hijax)return window.hijax;var o,r={UNSENT:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4};return n.prototype.getXHRMethod=function(e){return window.XMLHttpRequest.prototype[e]},n.prototype.setXHRMethod=function(e,t){window.XMLHttpRequest.prototype[e]=t},n.prototype.proxyXhrMethod=function(e,n,o){var r=t(this.getXHRMethod(e),n,o);this.setXHRMethod(e,r)},n.prototype.createProxy=function(t,n,o){var r=new e(t,n,o);return this.proxies[t]=r,r},n.prototype.set=function(e,t,n){return this.createProxy(e,t,n)},n.prototype.addListener=function(e,t,n){if(!(e in this.proxies))throw e+" proxy does not exist!";this.proxies[e].addListener(t,n)},n.prototype.dispatch=function(e,t,n){var o=this.proxies;for(var r in o)o.hasOwnProperty(r)&&o[r].fireEvent(e,t);"function"==typeof n&&n()},o=window.hijax=new n,o.proxyXhrMethod("open",function(e,t){this.url=t,o.active++,o.dispatch("beforeSend",this)}),o.proxyXhrMethod("send",function(){var e=this,n=function(){o.dispatch("receive",e)},i=function(){e.readyState===r.DONE&&o.dispatch("complete",e,function(){o.active--})},s=function(){e.proxied||("function"==typeof e.onreadystatechange?(e.onreadystatechange=t(e.onreadystatechange,n,i),e.proxied=!0):"function"==typeof e.onload?(e.onload=t(e.onload,n,i),e.proxied=!0):e.readyState===r.HEADERS_RECEIVED?n():e.readyState===r.DONE&&i())};e.addEventListener("readystatechange",s,!1)}),o});